+ * Designed to avoid building dense J. The function expects flattened vectors.
