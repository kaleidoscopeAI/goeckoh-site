let p = control_rho[i].max(1e-7);
let q = device_rho[i].max(1e-7);
