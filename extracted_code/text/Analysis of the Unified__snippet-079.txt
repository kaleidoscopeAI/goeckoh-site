c = copy.deepcopy(core)
purities = []
entropies = []
max_stresses = []
ok = True
for _ in range(steps):
    try:
        c.evolve_step(Hs, Ha, Hint, dt)
        c.adapt_bonds_hebb(eta=1e-5, decay=1e-6)
        d = c.diagnostics()
        purities.append(d["purity"])
        entropies.append(d["entropy"])
        max_stresses.append(d["max_stress"])
        # sanity checks
        if not np.isfinite(d["purity"]) or not np.isfinite(d["entropy"]):
            ok = False
            break
        # detect catastrophes: purity extremely low or enormous bond
        if d["purity"] < 1e-6 or np.max(c.B) > 1e8:
            ok = False
            break
    except Exception:
        ok = False
        break
metrics = {
    "avg_purity": float(np.mean(purities) if purities else 0.0),
    "avg_entropy": float(np.mean(entropies) if entropies else 0.0),
    "avg_max_stress": float(np.mean(max_stresses) if max_stresses else 0.0),
    "ok": bool(ok)
}
return metrics
