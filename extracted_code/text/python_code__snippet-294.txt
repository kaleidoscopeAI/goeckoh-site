result = set()
requested = set(requested or [])
available = set(available or [])
if '*' in requested:
    requested.remove('*')
    result |= available
for r in requested:
    if r == '-':
        result.add(r)
    elif r.startswith('-'):
        unwanted = r[1:]
        if unwanted not in available:
            logger.warning('undeclared extra: %s' % unwanted)
        if unwanted in result:
            result.remove(unwanted)
    else:
        if r not in available:
            logger.warning('undeclared extra: %s' % r)
        result.add(r)
return result


