if key in connected:
    return True
if key not in criteria:
    return False
for p in criteria[key].iter_parent():
    try:
        pkey = all_keys[id(p)]
    except KeyError:
        continue
    if pkey in connected:
        connected.add(key)
        return True
    if _has_route_to_root(criteria, pkey, all_keys, connected):
        connected.add(key)
        return True
return False


