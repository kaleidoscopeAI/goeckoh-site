"""Check if file is parsable as a requirements file.

This is heavily based on ``pkg_resources.parse_requirements``, but
simplified to just check the first meaningful line.

:raises InvalidRequirement: If the first meaningful line cannot be parsed
    as an requirement.
"""
with open(filename, encoding="utf-8", errors="ignore") as f:
    # Create a steppable iterator, so we can handle \-continuations.
    lines = (
        line
        for line in (line.strip() for line in f)
        if line and not line.startswith("#")  # Skip blank lines/comments.
    )

    for line in lines:
        # Drop comments -- a hash without a space may be in a URL.
        if " #" in line:
            line = line[: line.find(" #")]
        # If there is a line continuation, drop it, and append the next line.
        if line.endswith("\\"):
            line = line[:-2].strip() + next(lines, "")
        Requirement(line)
        return


