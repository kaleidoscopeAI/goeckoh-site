if tls_in_tls:
    if not SSLTransport:
        # Import error, ssl is not available.
        raise ProxySchemeUnsupported(
            "TLS in TLS requires support for the 'ssl' module"
        )

    SSLTransport._validate_ssl_context_for_tls_in_tls(ssl_context)
    return SSLTransport(sock, ssl_context, server_hostname)

if server_hostname:
    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)
else:
    return ssl_context.wrap_socket(sock)


