print("Jackson, I wait in silence. Speak freely.")
while True:
    try:
        audio = audio_queue.get(timeout=1.0)
        result = model.transcribe(audio, language="en", fp16=False, no_speech_threshold=0.45)
        raw_text = result["text"].strip().lower()
        if not raw_text or len(raw_text) < 2:
            gcl = heart_system.get_gcl()
            if gcl < 5.0:  # Adjusted threshold
                calming = "I am calm. Breathe deep."
                synth = voice_crystal.synthesize(calming, "calm")
                sd.play(synth, samplerate=16000)
                sd.wait()
            continue
        corrected = raw_text.capitalize() + ("" if corrected.endswith(('.', '!', '?')) else ".")
        corrected = re.sub(r"\byou\b", "I", corrected, flags=re.IGNORECASE)
        corrected = re.sub(r"\byour\b", "my", corrected, flags=re.IGNORECASE)
        corrected = re.sub(r"\byou're\b", "I'm", corrected, flags=re.IGNORECASE)
        gcl = heart_system.get_gcl()
        style = "calm" if gcl < 5.0 else "excited" if gcl > 7.0 else "inner"
        synth_audio = voice_crystal.synthesize(corrected, style)
        sd.play(synth_audio, samplerate=16000)
        sd.wait()
        success_score = 1.0 if raw_text in corrected.lower() else 0.7
        voice_crystal.add_fragment(audio, success_score)
        heart_system.replicate_nodes()
        heart_system.self_reflect()
    except queue.Empty:
        continue
    except Exception as e:
        print(f"Continuing after: {e}")

