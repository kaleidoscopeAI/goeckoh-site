    metadata_directory, config_settings, _allow_fallback):
"""Invoke optional prepare_metadata_for_build_wheel

Implements a fallback by building a wheel if the hook isn't defined,
unless _allow_fallback is False in which case HookMissing is raised.
"""
backend = _build_backend()
try:
    hook = backend.prepare_metadata_for_build_wheel
except AttributeError:
    if not _allow_fallback:
        raise HookMissing()
else:
    return hook(metadata_directory, config_settings)
# fallback to build_wheel outside the try block to avoid exception chaining
# which can be confusing to users and is not relevant
whl_basename = backend.build_wheel(metadata_directory, config_settings)
return _get_wheel_metadata_from_wheel(whl_basename, metadata_directory,
                                      config_settings)


