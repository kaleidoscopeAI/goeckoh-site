eps = 1e-12
energy = S + eps
cum = np.cumsum(energy, axis=0)
total = cum[-1, :]
targets = roll_percent * total
idxs = np.argmax(cum >= targets[None, :], axis=0)
return f[idxs]

