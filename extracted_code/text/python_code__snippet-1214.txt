"""
Parse a Simple API's Index Content, and yield its anchor elements as Link objects.
"""

content_type_l = page.content_type.lower()
if content_type_l.startswith("application/vnd.pypi.simple.v1+json"):
    data = json.loads(page.content)
    for file in data.get("files", []):
        link = Link.from_json(file, page.url)
        if link is None:
            continue
        yield link
    return

parser = HTMLLinkParser(page.url)
encoding = page.encoding or "utf-8"
parser.feed(page.content.decode(encoding))

url = page.url
base_url = parser.base_url or url
for anchor in parser.anchors:
    link = Link.from_element(anchor, page_url=url, base_url=base_url)
    if link is None:
        continue
    yield link


