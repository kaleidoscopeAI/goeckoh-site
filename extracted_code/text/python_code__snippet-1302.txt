# os.access doesn't work on Windows: http://bugs.python.org/issue2528
# and we can't use tempfile: http://bugs.python.org/issue22107
basename = "accesstest_deleteme_fishfingers_custard_"
alphabet = "abcdefghijklmnopqrstuvwxyz0123456789"
for _ in range(10):
    name = basename + "".join(random.choice(alphabet) for _ in range(6))
    file = os.path.join(path, name)
    try:
        fd = os.open(file, os.O_RDWR | os.O_CREAT | os.O_EXCL)
    except FileExistsError:
        pass
    except PermissionError:
        # This could be because there's a directory with the same name.
        # But it's highly unlikely there's a directory called that,
        # so we'll assume it's because the parent dir is not writable.
        # This could as well be because the parent dir is not readable,
        # due to non-privileged user access.
        return False
    else:
        os.close(fd)
        os.unlink(file)
        return True

# This should never be reached
raise OSError("Unexpected condition testing for writable directory")


