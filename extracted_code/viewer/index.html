<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Extracted Code Viewer</title>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; margin: 20px; }
    input, select { margin: 4px 0; padding: 6px; }
    .snippet { border-bottom: 1px solid #ddd; padding: 8px 0; }
    .preview { white-space: pre-wrap; font-family: monospace; background: #f7f7f7; padding: 8px; }
  </style>
</head>
<body>
  <h1>Extracted Code Viewer</h1>
  <div>
    <label>Search: <input id="q" placeholder="filename, language, source" size="40"></label>
    <label>Language: <select id="lang"><option value="">(any)</option></select></label>
  </div>
  <div id="summary"></div>
  <div id="results"></div>

  <script>
    async function load() {
      const idx = await fetch('../index.json').then(r=>r.json())
      const langs = [...new Set(idx.map(e=>e.lang))].sort()
      const sel = document.getElementById('lang')
      langs.forEach(l=>{ const o=document.createElement('option'); o.value=l; o.textContent=l; sel.appendChild(o) })
      document.getElementById('summary').textContent = `Total snippets: ${idx.length}`

      const results = document.getElementById('results')
      function render(list) {
        results.innerHTML = ''
        list.slice(0,200).forEach(e=>{
          const d = document.createElement('div'); d.className='snippet'
          const title = document.createElement('div'); title.innerHTML = `<strong>${e.snippet_file}</strong> (${e.lang}) â€” ${e.source} [${e.start_line}-${e.end_line}]`
          d.appendChild(title)
          const btn = document.createElement('button'); btn.textContent='preview'; btn.onclick=async ()=>{
            const p = await fetch('../'+e.snippet_file).then(r=>r.text())
            let pre = d.querySelector('.preview')
            if (!pre) { pre = document.createElement('div'); pre.className='preview'; d.appendChild(pre) }
            pre.textContent = p
          }
          d.appendChild(btn)
          results.appendChild(d)
        })
        if (list.length>200) {
          const more = document.createElement('div'); more.textContent = `Showing first 200 results of ${list.length}. Refine search to narrow results.`; results.appendChild(more)
        }
      }

      const input = document.getElementById('q')
      const langSel = document.getElementById('lang')
      function filter() {
        const q = input.value.toLowerCase()
        const l = langSel.value
        const filtered = idx.filter(e=>{
          if (l && e.lang!==l) return false
          if (!q) return true
          return e.snippet_file.toLowerCase().includes(q) || e.source.toLowerCase().includes(q) || (e.lang||'').toLowerCase().includes(q)
        })
        render(filtered)
      }
      input.addEventListener('input', filter)
      langSel.addEventListener('change', filter)
      render(idx)
    }
    load()
  </script>
</body>
</html>
