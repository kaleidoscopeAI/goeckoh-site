Key snippet (extended from your existing visualizer):

