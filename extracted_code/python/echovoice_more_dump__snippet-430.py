(This is the same implemented module from earlier with minor exports and slight adjustments for integration.)
